<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>localStorage Journey Viewer</title>

	<link rel="stylesheet" href="common.css">
	<link rel="stylesheet" href="localstorage.css">
	<link rel="shortcut icon" href="img/flag-square.png" type="image/png">
</head>
<body>
	<header>
		<h1>Rejseplanen Journey Logger</h1>
		<p>Log your journeys and view/export them later.</p>

		<nav>
			<a href="index.html"><span class="emoji-icon">‚ûï</span> Home / Add a Journey</a>
			<a href="localstorage.html" class="current"><span class="emoji-icon">üìÅ</span> Previous Journeys</a>
		</nav>
	</header>


	<button onclick="serverSave()" style="opacity: 0.5;">
		<span class="emoji-icon">‚òÅÔ∏è</span> Save to Server
	</button>

	<button onclick="serverLoad()" style="opacity: 0.5;">
		<span class="emoji-icon">‚òÅÔ∏è</span> Load from Server
	</button>

	<button onclick="clearLocalStorage()">
		<span class="emoji-icon">üóëÔ∏è</span> Clear localStorage
	</button>

	<br><br>

	<button onclick="exportJSON()"">
		<span class="emoji-icon">üî£</span> Export all as JSON
	</button>

	<button onclick="exportCSV()" style="opacity: 0.5;">
		<span class="emoji-icon">üìÉ</span> Export all as CSV (RailMiles.me format)
	</button>

	<button onclick="importJSON()" style="opacity: 0.5;">
		<span class="emoji-icon">üì§</span> Import JSON
	</button>


	<hr>

	<ol id="out">

	</ol>

	<script src="js/0common.js"></script>
	<script>
		const out = document.getElementById("out");

		if (!localStorage.getItem("journeys")) alert("Missing localStorage object");

		const journeys = JSON.parse(localStorage.getItem("journeys"));
		
		if(journeys.length === 0) alert("No journeys");

		for(const j of journeys) {
			// thank you, chatgpt:
			// "edit this piece of javascript so that all of the
			// "included ${} bits are 'Unset' if the variable doesnt exist"
			out.innerHTML += `
			<li>
				<h2>${j.origin ? j.origin : "Unset"} (${j.originPlatform ? j.originPlatform : "Unset"}) to ${j.destination ? j.destination : "Unset"} (${j.destinationPlatform ? j.destinationPlatform : "Unset"})</h2>
				<p>Departing ${j.departureTimeActual ? j.departureTimeActual : "Unset"} (planned ${j.departureTimePlanned ? j.departureTimePlanned : "Unset"})</p>
				<p>Arriving ${j.arrivalTimeActual ? j.arrivalTimeActual : "Unset"} (planned ${j.arrivalTimePlanned ? j.arrivalTimePlanned : "Unset"})</p>
				<p>${j.distanceKm ? j.distanceKm : "Unset"} Kilometres</p>
				<p>${j.route ? j.route : "Unset"}</p>
				<p>${j.identity ? j.identity : "Unset"} (${j.vehicleType ? j.vehicleType : "Unset"})</p>
				<p>${j.operatorName ? j.operatorName : "Unset"}</p>
				<p>Traction: ${j.vehicles ? j.vehicles : "Unset"}</p>
				<p>Note: <i>${j.notes ? j.notes : "Unset"}</i></p>
			</li>
			`;
		}

		function clearLocalStorage() {
			if(!confirm("Are you sure you want to clear everything?")) return;

			localStorage.clear();
			alert("localStorage cleared");
		}

		// thanks again, copilot
		function exportJSON() {
			const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(journeys));
			const dlAnchorElem = document.createElement('a');
			dlAnchorElem.setAttribute("href", dataStr);
			dlAnchorElem.setAttribute("download", `rjl-journeys-${Date.now()}.json`);
			dlAnchorElem.click();
		}

		function exportCSV() {
			return alert("Not implemented yet. Sorry!");
		}

		function importJSON() {
			return alert("Not implemented yet. Sorry!");
		}

		function serverSave() {
			return alert("Not implemented yet. Sorry!");
		}

		function serverLoad() {
			return alert("Not implemented yet. Sorry!");
		}
	</script>
</body>
</html>